version: v1.1.0
steps:
  - build: -t {{.Run.Registry}}/ghost:3-alpine-ai -f 3/alpine/ai/DOCKERFILE .
  - push: ["{{.Run.Registry}}/ghost:3-alpine-ai"]
  - cmd: mcr.microsoft.com/azure-cli:latest az login --identity
  - cmd: mcr.microsoft.com/azure-cli:latest az aks get-credentials --resource-group={{.Values.aksRG}} --name={{.Values.aksName}}
  - cmd: mcr.microsoft.com/azure-cli:latest az aks install-cli
  - cmd: mcr.microsoft.com/azure-cli:latest kubectl set image deployment/{{.Values.aksDeploymentName}} {{.Values.aksContainerName}}={{.Run.Registry}}/ghost:3-alpine-ai